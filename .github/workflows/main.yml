name: 🏗️ XsiteUAE iOS Auto Build

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  schedule:
    - cron: '0 3 * * 1'   # Every Monday at 3 AM (UAE time) – weekly auto-build

jobs:
  build:
    name: Build XsiteUAE (iPhone 17 Pro)
    runs-on: macos-latest

    steps:
      - name: 📦 Checkout repository
        uses: actions/checkout@v4

      - name: 🛠️ Set up latest Xcode
        uses: maxim-lobanov/setup-xcode@v1
        with:
          xcode-version: latest

      - name: ⚙️ Resolve Swift Packages
        run: |
          xcodebuild -resolvePackageDependencies \
          -project "Xsiteuae.xcodeproj"

            - name: 🧱 Build app for iPhone 17 Pro simulator
        run: |
          xcodebuild clean build \
          -project "Xsiteuae.xcodeproj" \
          -scheme "Xsiteuae" \
          -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=latest' \
          CODE_SIGNING_ALLOWED=NO

      - name: 🧪 Run unit tests
        run: |
          xcodebuild test \
          -project "Xsiteuae.xcodeproj" \
          -scheme "Xsiteuae" \
          -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=latest'


      - name: 🧹 Auto-commit shared-scheme updates
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "🔄 Auto-update: Shared scheme / build settings"

      - name: ✅ Status
        run: echo "✅ Build completed successfully for XsiteUAE (iPhone 17 Pro)"
